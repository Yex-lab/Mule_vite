import{c1 as ee,r as x,u as te,c as ae,bK as p,bL as se,bp as U,b3 as i,j as e,bd as _,B as r,bQ as u,ap as M,aK as ie,b as S,I as n,aq as F,p as k,T as m,c2 as re,aB as oe,c3 as ne,bI as T,a_ as w}from"./index-DzR_SryQ.js";import"./user-add.form-C3IzXE3u.js";import"./format-time-K3LaRyBo.js";import{u as le,E as ce}from"./enhanced-form-builder-CrQiAVKc.js";import{a as $,C as j}from"./custom-card-LkmwMllS.js";import{B as de}from"./Breadcrumbs-CpfBRh9G.js";import{T as ue,a as E}from"./Tabs-BwSGSZfk.js";import"./index-C6uWFXOn.js";import"./FormControlLabel-WwFoKCbJ.js";function me(){const o=ee();return x.useMemo(()=>o,[o])}function xe({userId:o,userData:v}){const L=te(),y=le(),{user:b}=ae(),[g,O]=x.useState(0),[c,C]=x.useState(!1),[A,D]=x.useState(""),[P,I]=x.useState(""),[B,f]=x.useState(null),Q=!!B,N=p.useQuery(se),V=U({mutationFn:t=>w.revokeUserSessions(t),onSuccess:()=>{p.invalidate?.(),i.info("Sessions revoked successfully")},onError:t=>{i.error("Error revoking sessions:",t)}}),W=U({mutationFn:t=>w.banUser(t),onSuccess:()=>{p.invalidate?.(),i.info("User deactivated successfully")},onError:t=>{i.error("Error deactivating user:",t)}}),z=U({mutationFn:t=>w.deleteUser(t),onSuccess:()=>{p.invalidate?.(),L.push(k.admin.userManagement.users),i.info("User deleted successfully")},onError:t=>{i.error("Error deleting user:",t)}}),s=v??N.data?.find(t=>t.id===o);if(i.debug("Profile - userId:",o),i.debug("Profile - usersQueryResult.data:",N.data),i.debug("Profile - found user:",s),N.isLoading)return e.jsxs(_,{children:[e.jsxs(r,{sx:{mb:3},children:[e.jsx(u,{variant:"text",width:200,height:40}),e.jsx(u,{variant:"text",width:300,height:24,sx:{mt:1}})]}),e.jsx(M,{children:e.jsxs($,{children:[e.jsxs(r,{sx:{display:"flex",gap:3,mb:3},children:[e.jsx(u,{variant:"circular",width:80,height:80}),e.jsxs(r,{sx:{flex:1},children:[e.jsx(u,{variant:"text",width:"60%",height:32}),e.jsx(u,{variant:"text",width:"40%",height:24,sx:{mt:1}})]})]}),e.jsx(u,{variant:"rectangular",height:200,sx:{borderRadius:1}})]})})]});if(!s)return e.jsx(_,{children:e.jsx(ie,{severity:"error",children:"User profile not found"})});const a=s.supabaseUser||{id:s.id,email:s.email,created_at:s.createdAt,last_sign_in_at:s.lastSignIn,email_confirmed_at:s.emailVerifiedAt,user_metadata:{}},l=s.profile||{displayName:s.name,firstName:s.firstName,lastName:s.lastName};c&&!A&&!P&&l&&(D(l?.firstName??""),I(l?.lastName??""));const d=(l?.displayName||`${l?.firstName??""} ${l?.lastName??""}`.trim()||a?.email?.split("@")[0])??"Unknown User",q=t=>t?"success":"warning",K=t=>t?"Active":"Pending",H=b?.displayName??b?.email?.split("@")[0]??"User",J=(t,h)=>{O(h)},G=()=>{c&&i.debug("Saving profile",{firstName:A,lastName:P}),C(!c)},X=async()=>{await y({title:"Revoke Sessions",message:`Are you sure you want to revoke all sessions for ${d}? They will be logged out immediately.`,confirmText:"Revoke",cancelText:"Cancel"})&&(i.debug("Revoking sessions for user:",o),V.mutate(o))},Y=async()=>{await y({title:"Deactivate User",message:`Are you sure you want to deactivate ${d}? They will not be able to log in.`,confirmText:"Deactivate",cancelText:"Cancel"})&&(i.debug("Deactivating user:",o),W.mutate(o))},Z=async()=>{await y({title:"Delete User",message:`Are you sure you want to delete ${d}? This action cannot be undone.`,variant:"danger",confirmText:"Delete",cancelText:"Cancel"})&&(i.debug("Deleting user:",o),z.mutate(o))};return e.jsxs(_,{maxWidth:"lg",children:[e.jsx(r,{sx:{mb:3},children:e.jsx(S,{onClick:()=>L.back(),startIcon:e.jsx(n,{icon:"solar:arrow-left-bold"}),sx:{color:"text.secondary","&:hover":{color:"text.primary",bgcolor:"action.hover"}},children:"Back to Users"})}),e.jsxs(de,{sx:{mb:4},children:[e.jsx(F,{href:k.dashboard.root,underline:"hover",color:"inherit",children:"Dashboard"}),e.jsx(F,{href:k.admin.userManagement.users,underline:"hover",color:"inherit",children:"Users"}),e.jsx(m,{color:"text.primary",children:d??"User Profile"})]}),e.jsx(M,{sx:{mb:4,background:t=>`linear-gradient(135deg, ${t.palette.primary.main}15 0%, ${t.palette.secondary.main}10 100%)`,border:t=>`1px solid ${t.palette.divider}`},children:e.jsx($,{sx:{pt:4,pb:3},children:e.jsxs(r,{sx:{display:"flex",alignItems:"flex-start",justifyContent:"space-between",gap:3},children:[e.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:3,flex:1},children:[e.jsx(re,{displayName:b?.displayName,photoURL:b?.photoURL,size:100}),e.jsxs(r,{sx:{flex:1},children:[e.jsxs(m,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:["Logged in as: ",H]}),e.jsx(m,{variant:"h4",sx:{fontWeight:700,mt:1},children:d}),e.jsx(m,{variant:"body1",color:"text.secondary",sx:{mt:.5},children:s?.supabaseUser?.email??"No email"})]})]}),e.jsxs(r,{sx:{display:"flex",gap:1},children:[e.jsx(S,{variant:c?"outlined":"contained",onClick:G,startIcon:e.jsx(n,{icon:c?"solar:check-circle-bold":"solar:pen-bold"}),children:c?"Save":"Edit"}),c&&e.jsx(S,{variant:"outlined",color:"inherit",onClick:()=>C(!1),startIcon:e.jsx(n,{icon:"solar:close-circle-bold"}),children:"Cancel"}),!c&&e.jsxs(e.Fragment,{children:[e.jsx(oe,{onClick:t=>f(t.currentTarget),size:"small",sx:{borderRadius:1},children:e.jsx(n,{icon:"solar:menu-dots-bold"})}),e.jsxs(ne,{anchorEl:B,open:Q,onClose:()=>f(null),anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},children:[e.jsxs(T,{onClick:()=>{X(),f(null)},children:[e.jsx(n,{icon:"solar:power-bold",sx:{mr:1}}),"Revoke Sessions"]}),e.jsxs(T,{onClick:()=>{Y(),f(null)},children:[e.jsx(n,{icon:"solar:close-square-bold",sx:{mr:1}}),"Deactivate User"]}),e.jsxs(T,{onClick:()=>{Z(),f(null)},sx:{color:"error.main"},children:[e.jsx(n,{icon:"solar:trash-bin-trash-bold",sx:{mr:1}}),"Delete User"]})]})]})]})]})})}),e.jsxs(ue,{value:g,onChange:J,sx:{borderBottom:1,borderColor:"divider",mb:3,"& .MuiTab-root":{textTransform:"none",minHeight:56,fontWeight:600,fontSize:"0.95rem"}},children:[e.jsx(E,{label:"Overview",icon:e.jsx(n,{icon:"solar:eye-bold"}),iconPosition:"start"}),e.jsx(E,{label:"Account",icon:e.jsx(n,{icon:"solar:settings-bold"}),iconPosition:"start"}),a?.user_metadata&&Object.keys(a.user_metadata).length>0&&e.jsx(E,{label:"Metadata",icon:e.jsx(n,{icon:"solar:document-text-bold-duotone"}),iconPosition:"start"})]}),g===0&&e.jsxs(r,{sx:{display:"grid",gridTemplateColumns:{xs:"1fr",md:"1fr 1fr 1fr"},gap:3},children:[c?e.jsxs(r,{children:[e.jsxs(r,{sx:{mb:2},children:[e.jsxs(m,{variant:"h6",sx:{fontWeight:700,display:"flex",alignItems:"center",gap:1},children:[e.jsx(n,{icon:"solar:user-bold",width:24}),"Personal Information"]}),e.jsx(m,{variant:"body2",color:"text.secondary",sx:{mt:.5},children:"Update your basic profile details"})]}),e.jsx(ce,{rows:[{fields:[{id:"firstName",name:"firstName",label:"First Name",type:"text"},{id:"lastName",name:"lastName",label:"Last Name",type:"text"}]}],defaultValues:{firstName:l?.firstName??"",lastName:l?.lastName??""},onSubmit:t=>{D(t.firstName),I(t.lastName),C(!1)},hideSubmitButton:!1,submitLabel:"Save Changes"})]}):e.jsx(j,{config:{title:"Personal Information",subtitle:"Update your basic profile details",icon:"solar:user-bold-duotone",data:[{label:"Full Name",value:d},{label:"Email",value:a?.email??"—",type:"email"},{label:"First Name",value:l?.firstName??"—"},{label:"Last Name",value:l?.lastName??"—"}],layout:{columns:1}}}),e.jsx(j,{config:{title:"Quick Info",subtitle:"Account status and verification details",icon:"solar:info-circle-bold-duotone",data:[{label:"Status",value:K(!!a?.email_confirmed_at),type:"label",labelConfig:{color:q(!!a?.email_confirmed_at),variant:"outlined"}},{label:"Email Verified",value:a?.email_confirmed_at?"Verified":"Unverified",type:"label",labelConfig:{color:a?.email_confirmed_at?"success":"error",variant:"outlined"}},{label:"User ID",value:a?.id??"—",fullWidth:!0}]}})]}),g===1&&e.jsx(r,{sx:{display:"grid",gridTemplateColumns:{xs:"1fr",md:"1fr 1fr 1fr"},gap:3},children:e.jsx(j,{config:{title:"Account Activity",subtitle:"Login and verification timeline",icon:"solar:history-bold-duotone",data:[{label:"Account Created",value:a?.created_at?new Date(a.created_at).toLocaleString():"—",type:"date"},{type:"divider"},{label:"Last Login",value:a?.last_sign_in_at?new Date(a.last_sign_in_at).toLocaleString():"Never",type:"date"},{type:"divider"},{label:"Email Verification",value:a?.email_confirmed_at?"Verified":"Unverified",type:"label",labelConfig:{color:a?.email_confirmed_at?"success":"error",variant:"outlined"}}]}})}),g===2&&a?.user_metadata&&Object.keys(a.user_metadata).length>0&&e.jsx(r,{sx:{display:"grid",gridTemplateColumns:{xs:"1fr",md:"1fr 1fr 1fr"},gap:3},children:e.jsx(j,{config:{title:"User Metadata",subtitle:"Additional system and profile information",icon:"solar:code-bold-duotone",data:Object.entries(a.user_metadata).map(([t,h])=>({label:t.split("_").map(R=>R.charAt(0).toUpperCase()+R.slice(1)).join(" "),value:typeof h=="string"?h:JSON.stringify(h),fullWidth:!0}))}})})]})}function Ue(){const v=me().id;return e.jsx(xe,{userId:v})}export{Ue as default};
