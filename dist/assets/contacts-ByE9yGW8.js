import{j as t,T as g,r as u,bk as F,B as f,S as C,aB as P,I as b,b as w,bl as j,c as R,b0 as W,bm as _,aR as A,bd as Q,bg as E,C as $}from"./index-DzR_SryQ.js";import{E as L,u as M}from"./enhanced-form-builder-CrQiAVKc.js";import{A as O,D as q}from"./actions-cell-D2uG9A6N.js";import{A as z}from"./avatar-name-cell-6NGxl_zJ.js";import{P as U}from"./page-header-CS2V_FKh.js";import{u as T}from"./use-translation-Bij3JYAK.js";import{s as V,c as G,f as H}from"./contact.form-Dx9V9TXk.js";import"./user-add.form-C3IzXE3u.js";import"./index-C6uWFXOn.js";import"./FormControlLabel-WwFoKCbJ.js";import"./Tabs-BwSGSZfk.js";import"./Breadcrumbs-CpfBRh9G.js";function S({value:e,fallback:l="-",variant:r="body2",color:a="textPrimary",noWrap:i=!1}){return t.jsx(g,{variant:r,color:a,noWrap:i,sx:i?{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}:void 0,children:e||l})}function J({open:e,onClose:l,contact:r}){const{t:a}=T(),i=r?.contactid,m=i?"update":"create",h=u.useMemo(()=>a(m==="create"?"contacts.form.addTitle":"contacts.form.editTitle"),[m,a]),c=u.useMemo(()=>a(m==="create"?"contacts.form.addSubtitle":"contacts.form.editSubtitle"),[m,a]),d=u.useMemo(()=>[{fields:[{id:"firstname",name:"firstname",label:a("contacts.form.firstName"),type:"text",required:!0,placeholder:a("contacts.form.placeholders.firstName")},{id:"lastname",name:"lastname",label:a("contacts.form.lastName"),type:"text",required:!0,placeholder:a("contacts.form.placeholders.lastName")}]},{fields:[{id:"emailaddress1",name:"emailaddress1",label:a("contacts.form.email"),type:"email",required:!0,placeholder:a("contacts.form.placeholders.email")}]},{fields:[{id:"jobtitle",name:"jobtitle",label:a("contacts.form.jobTitle"),type:"text",placeholder:a("contacts.form.placeholders.jobTitle")}]},{fields:[{id:"telephone1",name:"telephone1",label:a("contacts.form.phone"),type:"phone",placeholder:a("contacts.form.placeholders.phone")},{id:"telephone1_ext",name:"telephone1_ext",label:a("contacts.form.extension"),type:"text",placeholder:a("contacts.form.placeholders.extension")}]},{fields:[{id:"statecode",name:"statecode",label:a("contacts.form.status"),type:"select",options:[{value:"None",label:a("contacts.identityStatus.none"),color:"default"},{value:"Invited",label:a("contacts.identityStatus.invited"),color:"info"},{value:"Registered",label:a("contacts.identityStatus.registered"),color:"success"},{value:"Inactive",label:a("contacts.identityStatus.inactive"),color:"warning"},{value:"Blocked",label:a("contacts.identityStatus.blocked"),color:"error"}]}]}],[a]),p=()=>{j.invalidate?.(),l()},y=r?{...r,telephone1:V(r.telephone1?.split(" ")[0]),telephone1_ext:r.telephone1?.split(" ")[1]||"",statecode:r.statecode||"None"}:{statecode:"None"};return t.jsx(F,{anchor:"right",open:e,onClose:l,children:t.jsxs(f,{sx:{width:480,height:"100%",display:"flex",flexDirection:"column"},children:[t.jsx(f,{sx:{p:3,borderBottom:1,borderColor:"divider"},children:t.jsxs(C,{direction:"row",alignItems:"flex-start",justifyContent:"space-between",children:[t.jsxs(f,{children:[t.jsx(g,{variant:"h6",children:h}),t.jsx(g,{variant:"body2",color:"text.secondary",sx:{mt:.5},children:c})]}),t.jsx(P,{onClick:l,size:"small",children:t.jsx(b,{icon:"mingcute:close-line"})})]})}),t.jsx(f,{sx:{flex:1,overflow:"auto",p:3},children:t.jsx(L,{rows:d,store:G,mode:m,entityId:i,defaultValues:y,hideSubmitButton:!0,onSuccess:p})}),t.jsx(f,{sx:{p:3,borderTop:1,borderColor:"divider"},children:t.jsxs(C,{direction:"row",spacing:2,justifyContent:"flex-end",children:[t.jsx(w,{onClick:l,variant:"outlined",children:a("contacts.form.cancel")}),t.jsx(w,{type:"submit",form:"enhanced-form",variant:"contained",children:a(m==="create"?"contacts.form.create":"contacts.form.update")})]})})]})})}const K=e=>({id:e.contactid,key:e.contactid,name:e.fullname||`${e.firstname??""} ${e.lastname??""}`.trim()||"Unknown",email:e.emailaddress1??"",phone:H(e.telephone1??""),jobTitle:e.jobtitle??"",department:e.department??"",manager:e.managername??"",createdOn:e.createdon??"",status:e.statecode??"None"});function X(){const{t:e}=T(),{user:l}=R(),r=M(),[a,i]=u.useState(!1),[m,h]=u.useState(null),c=j.useQuery(W),{filters:d,selectedIds:p,setFilters:y,toggleSelected:Z,clearSelected:ee}=_();console.log("ContactsSlice state:",{filters:d,selectedIds:p});const k=u.useMemo(()=>c.data?c.data.filter(o=>{if(d.status&&d.status!=="all"&&o.statecode!==d.status)return!1;if(d.searchQuery){const s=d.searchQuery.toLowerCase();if(!`${o.firstname} ${o.lastname} ${o.emailaddress1}`.toLowerCase().includes(s))return!1}return o.emailaddress1!==l?.email}).sort((o,s)=>{const n=o.createdon?new Date(o.createdon).getTime():0;return(s.createdon?new Date(s.createdon).getTime():0)-n}).map(K):[],[c.data,d,l?.email]),I=()=>{h(null),i(!0)},v=o=>{const s=c.data?.find(n=>n.contactid===o.id);h(s??null),i(!0)},N=async o=>{if(await r({title:e("contacts.delete.title"),message:e("contacts.delete.message",{name:o.name}),variant:"danger",confirmText:e("contacts.delete.confirm"),cancelText:e("contacts.delete.cancel")}))try{await E.deleteContact(o.id),j.invalidate?.()}catch(n){console.error("Failed to delete contact:",n)}},B=[{id:"name",label:e("contacts.columns.name"),width:280,minWidth:280,sortable:!0,render:(o,s)=>t.jsx(z,{name:s.name??"Unknown",email:s.email,onClick:()=>v(s)})},{id:"jobTitle",label:e("contacts.columns.jobTitle"),width:280,minWidth:200,sortable:!0,render:(o,s)=>t.jsx(S,{value:s.jobTitle})},{id:"phone",label:e("contacts.columns.phone"),width:180,minWidth:150,sortable:!0,render:(o,s)=>t.jsx(S,{value:s.phone,color:"textSecondary",noWrap:!0})},{id:"status",label:e("contacts.columns.status"),width:120,minWidth:120,sortable:!0,render:(o,s)=>{const n={None:{label:e("contacts.identityStatus.none"),color:"default"},Invited:{label:e("contacts.identityStatus.invited"),color:"info"},Registered:{label:e("contacts.identityStatus.registered"),color:"success"},Inactive:{label:e("contacts.identityStatus.inactive"),color:"warning"},Blocked:{label:e("contacts.identityStatus.blocked"),color:"error"}},x=n[s.status]||n.None;return t.jsx(A,{label:x.label,color:x.color,size:"small"})}},{id:"actions",label:"",width:80,minWidth:80,maxWidth:80,render:(o,s)=>{const n=[{id:"edit",label:e("contacts.actions.edit"),icon:t.jsx(b,{icon:"solar:pen-bold"}),onClick:()=>v(s)},{id:"delete",label:e("contacts.actions.delete"),icon:t.jsx(b,{icon:"solar:trash-bin-trash-bold"}),onClick:()=>N(s),color:"error"}];return t.jsx(O,{actions:n,moreIcon:t.jsx(b,{icon:"eva:more-vertical-fill"})})}}],D=[{id:"all",label:e("contacts.filters.all"),filter:o=>o},{id:"invited",label:e("contacts.filters.invited"),filter:o=>o.filter(s=>s.status==="Invited"),color:"info"},{id:"registered",label:e("contacts.filters.registered"),filter:o=>o.filter(s=>s.status==="Registered"),color:"success"},{id:"inactive",label:e("contacts.filters.inactive"),filter:o=>o.filter(s=>s.status==="Inactive"),color:"warning"},{id:"blocked",label:e("contacts.filters.blocked"),filter:o=>o.filter(s=>s.status==="Blocked"),color:"error"}];return t.jsxs(Q,{children:[t.jsx(U,{title:e("contacts.title"),description:e("contacts.description"),breadcrumbs:[{label:e("contacts.breadcrumb.workspace")},{label:e("contacts.breadcrumb.contacts")}],action:{label:e("contacts.add"),onClick:I,icon:t.jsx(b,{icon:"mingcute:add-line"})}}),t.jsx(q,{store:{useQuery:()=>({data:k,isLoading:c.isLoading,error:c.error,refetch:c.refetch})},columns:B,getRowId:o=>String(o.id),filterTabs:D,searchConfig:{placeholder:e("contacts.search"),searchFields:["name","email","phone","jobTitle","department","manager"]},labels:{search:e("contacts.search"),keyword:e("dataTable.keyword"),clear:e("dataTable.clear"),resultsFound:e("dataTable.resultsFound"),dense:e("dataTable.dense"),rowsPerPage:e("dataTable.rowsPerPage")}},"contacts-table"),t.jsx(J,{open:a,onClose:()=>i(!1),contact:m})]})}const Y={title:`Contacts | My Workspace - ${$.appName}`};function fe(){return t.jsxs(t.Fragment,{children:[t.jsx("title",{children:Y.title}),t.jsx(X,{})]})}export{fe as default};
