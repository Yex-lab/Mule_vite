{
  "openapi": "3.0.0",
  "paths": {
    "/api": {
      "get": {
        "operationId": "AppController_getInfo",
        "parameters": [],
        "responses": {
          "200": {
            "description": "Application information"
          }
        },
        "summary": "Get application info",
        "tags": [
          "Application"
        ]
      }
    },
    "/api/health": {
      "get": {
        "operationId": "HealthController_checkHealth",
        "parameters": [],
        "responses": {
          "200": {
            "description": "System is healthy"
          }
        },
        "summary": "Check overall system health",
        "tags": [
          "Health"
        ]
      }
    },
    "/api/health/database": {
      "get": {
        "operationId": "HealthController_checkDatabase",
        "parameters": [],
        "responses": {
          "200": {
            "description": "Database is healthy"
          }
        },
        "summary": "Check database connectivity",
        "tags": [
          "Health"
        ]
      }
    },
    "/api/auth/validate": {
      "post": {
        "description": "Validates a Supabase access token and creates or updates the user profile in the local database.",
        "operationId": "AuthAdminController_validateToken",
        "parameters": [],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/ValidateTokenDto"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Token validated successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "user": {
                      "type": "object",
                      "properties": {
                        "id": {
                          "type": "string",
                          "example": "a1b2c3d4-e5f6-7890-abcd-ef1234567890"
                        },
                        "email": {
                          "type": "string",
                          "example": "user@example.com"
                        },
                        "profile": {
                          "type": "object",
                          "properties": {
                            "displayName": {
                              "type": "string",
                              "example": "John Doe"
                            },
                            "firstName": {
                              "type": "string",
                              "example": "John"
                            },
                            "lastName": {
                              "type": "string",
                              "example": "Doe"
                            }
                          }
                        }
                      }
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "Missing or malformed token"
          },
          "401": {
            "description": "Invalid or expired Supabase token"
          }
        },
        "summary": "Validate Supabase token",
        "tags": [
          "Authentication"
        ]
      }
    },
    "/api/auth/refresh": {
      "post": {
        "description": "Refreshes an expired Supabase session using a refresh token to get new access and refresh tokens.",
        "operationId": "AuthAdminController_refreshToken",
        "parameters": [],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/RefreshTokenDto"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Token refreshed successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "access_token": {
                      "type": "string",
                      "example": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
                      "description": "New Supabase access token"
                    },
                    "refresh_token": {
                      "type": "string",
                      "example": "refresh_token_eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
                      "description": "New refresh token"
                    },
                    "expires_in": {
                      "type": "number",
                      "example": 3600,
                      "description": "Token expiration time in seconds"
                    },
                    "user": {
                      "type": "object",
                      "properties": {
                        "id": {
                          "type": "string",
                          "example": "a1b2c3d4-e5f6-7890-abcd-ef1234567890"
                        },
                        "email": {
                          "type": "string",
                          "example": "user@example.com"
                        }
                      }
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "Missing refresh token"
          },
          "401": {
            "description": "Invalid or expired refresh token"
          }
        },
        "summary": "Refresh Supabase session",
        "tags": [
          "Authentication"
        ]
      }
    },
    "/api/auth/me": {
      "get": {
        "description": "Retrieves the authenticated user's profile information from the Supabase JWT token.",
        "operationId": "AuthAdminController_getProfile",
        "parameters": [],
        "responses": {
          "200": {
            "description": "User profile retrieved successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "id": {
                      "type": "string",
                      "example": "a1b2c3d4-e5f6-7890-abcd-ef1234567890"
                    },
                    "email": {
                      "type": "string",
                      "example": "user@example.com"
                    },
                    "user_metadata": {
                      "type": "object",
                      "example": {
                        "first_name": "John",
                        "last_name": "Doe",
                        "role": "user"
                      }
                    },
                    "created_at": {
                      "type": "string",
                      "example": "2024-01-15T10:30:00Z"
                    },
                    "last_sign_in_at": {
                      "type": "string",
                      "example": "2024-01-20T14:30:00Z"
                    }
                  }
                }
              }
            }
          },
          "401": {
            "description": "Authentication required - missing or invalid JWT"
          }
        },
        "security": [
          {
            "bearer": []
          }
        ],
        "summary": "Get current user profile",
        "tags": [
          "Authentication"
        ]
      }
    },
    "/api/auth/logout": {
      "post": {
        "description": "Logs out the current user. Note: This is a client-side logout - the JWT remains valid until expiration.",
        "operationId": "AuthAdminController_logout",
        "parameters": [],
        "responses": {
          "200": {
            "description": "Logged out successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "message": {
                      "type": "string",
                      "example": "Logged out successfully"
                    },
                    "timestamp": {
                      "type": "string",
                      "example": "2024-01-20T14:30:00Z"
                    }
                  }
                }
              }
            }
          },
          "401": {
            "description": "Authentication required"
          }
        },
        "security": [
          {
            "bearer": []
          }
        ],
        "summary": "Logout user",
        "tags": [
          "Authentication"
        ]
      }
    },
    "/api/user-management/profiles": {
      "get": {
        "description": "Retrieve all user profiles from the application database. This includes display names, preferences, avatars, and other business-specific user data that extends beyond basic authentication. Used for user management dashboards and administrative features.",
        "operationId": "UserProfileController_getAllUserProfiles",
        "parameters": [
          {
            "name": "organizationId",
            "required": false,
            "in": "query",
            "description": "Filter profiles by organization UUID",
            "schema": {
              "example": "a1b2c3d4-e5f6-7890-abcd-ef1234567890",
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Successfully retrieved all user profiles",
            "content": {
              "application/json": {
                "schema": {
                  "type": "array",
                  "items": {
                    "$ref": "#/components/schemas/UserProfileDto"
                  }
                }
              }
            }
          }
        },
        "summary": "List all user profiles",
        "tags": [
          "User Management"
        ]
      }
    },
    "/api/user-management/profile/email/{email}": {
      "get": {
        "description": "Retrieve a user profile by email address. Looks up the user in Supabase auth by email, then returns their profile from the local database.",
        "operationId": "UserProfileController_getUserProfileByEmail",
        "parameters": [
          {
            "name": "email",
            "required": true,
            "in": "path",
            "description": "User email address",
            "schema": {
              "example": "john.doe@example.com",
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "User profile retrieved successfully",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/UserProfileDto"
                }
              }
            }
          },
          "404": {
            "description": "User not found"
          }
        },
        "summary": "Get user profile by email",
        "tags": [
          "User Management"
        ]
      }
    },
    "/api/user-management/{userId}/profile": {
      "get": {
        "description": "Retrieve a specific user's profile information including display name, avatar, timezone, locale preferences, and custom application settings. This data is separate from authentication data and focuses on user experience customization.",
        "operationId": "UserProfileController_getUserProfile",
        "parameters": [
          {
            "name": "userId",
            "required": true,
            "in": "path",
            "description": "User UUID that references the auth.users.id from Supabase",
            "schema": {
              "example": "a1b2c3d4-e5f6-7890-abcd-ef1234567890",
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "User profile retrieved successfully",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/UserProfileDto"
                }
              }
            }
          },
          "404": {
            "description": "User profile not found"
          }
        },
        "summary": "Get user profile by ID",
        "tags": [
          "User Management"
        ]
      },
      "post": {
        "description": "Create a new user profile record for an authenticated user. This typically happens after successful user registration to establish their application-specific preferences, display settings, and business data separate from their authentication record.",
        "operationId": "UserProfileController_createUserProfile",
        "parameters": [
          {
            "name": "userId",
            "required": true,
            "in": "path",
            "description": "User UUID from Supabase auth system to create profile for",
            "schema": {
              "example": "a1b2c3d4-e5f6-7890-abcd-ef1234567890",
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/CreateUserProfileDto"
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "User profile created successfully",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/UserProfileDto"
                }
              }
            }
          },
          "400": {
            "description": "Invalid profile data or user already has a profile"
          },
          "404": {
            "description": "Referenced user ID does not exist in auth system"
          }
        },
        "summary": "Create new user profile",
        "tags": [
          "User Management"
        ]
      },
      "put": {
        "description": "Update user profile data such as display name, avatar URL, timezone, locale, or custom preferences. This allows users to personalize their application experience and maintain their business-specific settings independently of their authentication data.",
        "operationId": "UserProfileController_updateUserProfile",
        "parameters": [
          {
            "name": "userId",
            "required": true,
            "in": "path",
            "description": "User UUID to update profile for",
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/UpdateUserProfileDto"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "User profile updated successfully",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/UserProfileDto"
                }
              }
            }
          },
          "400": {
            "description": "Invalid update data provided"
          },
          "404": {
            "description": "User profile not found"
          }
        },
        "summary": "Update user profile information",
        "tags": [
          "User Management"
        ]
      },
      "delete": {
        "description": "Permanently delete a user's profile data while preserving their authentication record. This removes display preferences, custom settings, and business data but allows the user to continue authenticating. Useful for data privacy compliance or account cleanup.",
        "operationId": "UserProfileController_deleteUserProfile",
        "parameters": [
          {
            "name": "userId",
            "required": true,
            "in": "path",
            "description": "User UUID to delete profile for",
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "User profile deleted successfully"
          },
          "404": {
            "description": "User profile not found"
          }
        },
        "summary": "Delete user profile",
        "tags": [
          "User Management"
        ]
      }
    },
    "/api/user-management/{userId}/profile/organization": {
      "patch": {
        "description": "Update the organization assignment for a user profile. Sets the organizationId field to associate the user with a specific organization.",
        "operationId": "UserProfileController_updateUserOrganization",
        "parameters": [
          {
            "name": "userId",
            "required": true,
            "in": "path",
            "description": "User UUID to update organization for",
            "schema": {
              "example": "a1b2c3d4-e5f6-7890-abcd-ef1234567890",
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/UpdateOrganizationDto"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Organization updated successfully",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/UserProfileDto"
                }
              }
            }
          },
          "400": {
            "description": "Invalid organization ID format"
          },
          "404": {
            "description": "User profile not found"
          }
        },
        "summary": "Update user organization",
        "tags": [
          "User Management"
        ]
      }
    },
    "/api/user-management/admin/users/refresh-view": {
      "post": {
        "description": "Manually refresh the user_profiles_with_auth materialized view to get latest data from auth.users and user_profiles tables.",
        "operationId": "UserProfileController_refreshUserProfilesView",
        "parameters": [],
        "responses": {
          "200": {
            "description": "Materialized view refreshed successfully",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/RefreshViewResponseDto"
                }
              }
            }
          },
          "500": {
            "description": "Failed to refresh materialized view"
          }
        },
        "security": [
          {
            "bearer": []
          }
        ],
        "summary": "Refresh user profiles materialized view (Admin)",
        "tags": [
          "User Management"
        ]
      }
    },
    "/api/user-management/admin/users": {
      "post": {
        "description": "Create a new user in Supabase auth system and automatically create a local profile if user_metadata is provided. The profile will include displayName, firstName, and lastName extracted from the metadata.",
        "operationId": "UserProfileController_createUser",
        "parameters": [],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/CreateUserDto"
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "User created successfully with optional profile",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/CreateUserResponseDto"
                }
              }
            }
          },
          "400": {
            "description": "Invalid user data or email already exists"
          },
          "403": {
            "description": "Admin access required"
          }
        },
        "security": [
          {
            "bearer": []
          }
        ],
        "summary": "Create new user (Admin)",
        "tags": [
          "User Management"
        ]
      },
      "get": {
        "description": "List all users with pagination using materialized view for optimal performance. Combines Supabase auth data with local profiles for comprehensive user management.",
        "operationId": "UserProfileController_listUsers",
        "parameters": [
          {
            "name": "page",
            "required": false,
            "in": "query",
            "description": "Page number for pagination",
            "schema": {
              "example": 1,
              "type": "number"
            }
          },
          {
            "name": "perPage",
            "required": false,
            "in": "query",
            "description": "Items per page (max: 1000 for government compliance)",
            "schema": {
              "example": 50,
              "type": "number"
            }
          },
          {
            "name": "maxLimit",
            "required": false,
            "in": "query",
            "description": "Maximum records limit for security",
            "schema": {
              "example": 1000,
              "type": "number"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Users retrieved successfully with cross-schema data",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "users": {
                      "type": "array",
                      "items": {
                        "type": "object",
                        "properties": {
                          "id": {
                            "type": "string",
                            "example": "a1b2c3d4-e5f6-7890-abcd-ef1234567890"
                          },
                          "email": {
                            "type": "string",
                            "example": "john.doe@example.com"
                          },
                          "created_at": {
                            "type": "string",
                            "example": "2024-01-15T10:30:00Z"
                          },
                          "user_metadata": {
                            "type": "object",
                            "example": {
                              "first_name": "John",
                              "last_name": "Doe"
                            }
                          },
                          "profile": {
                            "type": "object",
                            "properties": {
                              "displayName": {
                                "type": "string",
                                "example": "John Doe"
                              },
                              "timezone": {
                                "type": "string",
                                "example": "America/New_York"
                              },
                              "preferences": {
                                "type": "object",
                                "example": {
                                  "theme": "dark"
                                }
                              }
                            }
                          }
                        }
                      }
                    },
                    "pagination": {
                      "type": "object",
                      "properties": {
                        "page": {
                          "type": "number",
                          "example": 1
                        },
                        "perPage": {
                          "type": "number",
                          "example": 50
                        },
                        "total": {
                          "type": "number",
                          "example": 150
                        },
                        "totalPages": {
                          "type": "number",
                          "example": 3
                        }
                      }
                    }
                  }
                }
              }
            }
          }
        },
        "summary": "List users (Admin)",
        "tags": [
          "User Management"
        ]
      }
    },
    "/api/user-management/admin/users/organization/{organizationId}": {
      "get": {
        "description": "Get all users belonging to a specific organization with their profiles",
        "operationId": "UserProfileController_getUsersByOrganization",
        "parameters": [
          {
            "name": "organizationId",
            "required": true,
            "in": "path",
            "description": "Organization UUID",
            "schema": {
              "example": "a1b2c3d4-e5f6-7890-abcd-ef1234567890",
              "type": "string"
            }
          },
          {
            "name": "refreshView",
            "required": false,
            "in": "query",
            "description": "Refresh materialized view before querying (default: true)",
            "schema": {
              "example": true,
              "type": "boolean"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Users with profiles retrieved successfully"
          }
        },
        "security": [
          {
            "bearer": []
          }
        ],
        "summary": "Get users by organization (Admin)",
        "tags": [
          "User Management"
        ]
      }
    },
    "/api/user-management/admin/users/{id}": {
      "get": {
        "description": "Get Supabase user details by ID.",
        "operationId": "UserProfileController_getUser",
        "parameters": [
          {
            "name": "id",
            "required": true,
            "in": "path",
            "description": "User UUID from Supabase auth system",
            "schema": {
              "example": "a1b2c3d4-e5f6-7890-abcd-ef1234567890",
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "User retrieved successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "id": {
                      "type": "string",
                      "example": "a1b2c3d4-e5f6-7890-abcd-ef1234567890"
                    },
                    "email": {
                      "type": "string",
                      "example": "john.doe@example.com"
                    },
                    "created_at": {
                      "type": "string",
                      "example": "2024-01-15T10:30:00Z"
                    },
                    "last_sign_in_at": {
                      "type": "string",
                      "example": "2024-01-20T14:30:00Z"
                    },
                    "user_metadata": {
                      "type": "object",
                      "example": {
                        "first_name": "John",
                        "last_name": "Doe",
                        "role": "user"
                      }
                    }
                  }
                }
              }
            }
          },
          "401": {
            "description": "Authentication required"
          },
          "403": {
            "description": "Admin access required"
          },
          "404": {
            "description": "User not found"
          }
        },
        "security": [
          {
            "bearer": []
          }
        ],
        "summary": "Get user by ID (Admin)",
        "tags": [
          "User Management"
        ]
      },
      "put": {
        "description": "Update user in Supabase auth system and local profile.",
        "operationId": "UserProfileController_updateUser",
        "parameters": [
          {
            "name": "id",
            "required": true,
            "in": "path",
            "description": "User UUID",
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/UpdateUserDto"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "User updated successfully"
          },
          "404": {
            "description": "User not found"
          }
        },
        "security": [
          {
            "bearer": []
          }
        ],
        "summary": "Update user (Admin)",
        "tags": [
          "User Management"
        ]
      },
      "delete": {
        "description": "Delete user from Supabase auth system and local profile.",
        "operationId": "UserProfileController_deleteUser",
        "parameters": [
          {
            "name": "id",
            "required": true,
            "in": "path",
            "description": "User UUID",
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "User deleted successfully"
          },
          "404": {
            "description": "User not found"
          }
        },
        "security": [
          {
            "bearer": []
          }
        ],
        "summary": "Delete user (Admin)",
        "tags": [
          "User Management"
        ]
      }
    },
    "/api/user-management/admin/users/{id}/with-profile": {
      "get": {
        "description": "Get specific user details including Supabase auth data and local profile. Provides complete user information for administrative purposes.",
        "operationId": "UserProfileController_getUserWithProfile",
        "parameters": [
          {
            "name": "id",
            "required": true,
            "in": "path",
            "description": "User UUID from Supabase auth system",
            "schema": {
              "example": "a1b2c3d4-e5f6-7890-abcd-ef1234567890",
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "User retrieved successfully with cross-schema data",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "supabaseUser": {
                      "type": "object",
                      "properties": {
                        "id": {
                          "type": "string",
                          "example": "a1b2c3d4-e5f6-7890-abcd-ef1234567890"
                        },
                        "email": {
                          "type": "string",
                          "example": "john.doe@example.com"
                        },
                        "created_at": {
                          "type": "string",
                          "example": "2024-01-15T10:30:00Z"
                        },
                        "last_sign_in_at": {
                          "type": "string",
                          "example": "2024-01-20T14:30:00Z"
                        },
                        "user_metadata": {
                          "type": "object",
                          "example": {
                            "first_name": "John",
                            "last_name": "Doe",
                            "role": "user"
                          }
                        }
                      }
                    },
                    "profile": {
                      "type": "object",
                      "properties": {
                        "id": {
                          "type": "string",
                          "example": "profile-uuid-123"
                        },
                        "displayName": {
                          "type": "string",
                          "example": "John Doe"
                        },
                        "firstName": {
                          "type": "string",
                          "example": "John"
                        },
                        "lastName": {
                          "type": "string",
                          "example": "Doe"
                        },
                        "timezone": {
                          "type": "string",
                          "example": "America/New_York"
                        },
                        "preferences": {
                          "type": "object",
                          "example": {
                            "theme": "dark"
                          }
                        }
                      }
                    }
                  }
                }
              }
            }
          },
          "401": {
            "description": "Authentication required"
          },
          "403": {
            "description": "Admin access required"
          },
          "404": {
            "description": "User not found"
          }
        },
        "security": [
          {
            "bearer": []
          }
        ],
        "summary": "Get user with profile (Admin)",
        "tags": [
          "User Management"
        ]
      }
    },
    "/api/user-management/admin/users/{id}/reset-password": {
      "post": {
        "description": "Reset user password and generate new temporary password.",
        "operationId": "UserProfileController_resetUserPassword",
        "parameters": [
          {
            "name": "id",
            "required": true,
            "in": "path",
            "description": "User UUID",
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Password reset successfully"
          }
        },
        "security": [
          {
            "bearer": []
          }
        ],
        "summary": "Reset user password (Admin)",
        "tags": [
          "User Management"
        ]
      }
    },
    "/api/user-management/admin/users/{id}/magic-link": {
      "post": {
        "description": "Generate magic link for passwordless user login.",
        "operationId": "UserProfileController_generateMagicLink",
        "parameters": [
          {
            "name": "id",
            "required": true,
            "in": "path",
            "description": "User UUID",
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Magic link generated successfully"
          }
        },
        "security": [
          {
            "bearer": []
          }
        ],
        "summary": "Generate magic link (Admin)",
        "tags": [
          "User Management"
        ]
      }
    },
    "/api/user-management/admin/users/{id}/ban": {
      "post": {
        "description": "Ban user account for specified duration.",
        "operationId": "UserProfileController_banUser",
        "parameters": [
          {
            "name": "id",
            "required": true,
            "in": "path",
            "description": "User UUID",
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/BanUserDto"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "User banned successfully"
          }
        },
        "security": [
          {
            "bearer": []
          }
        ],
        "summary": "Ban user (Admin)",
        "tags": [
          "User Management"
        ]
      }
    },
    "/api/user-management/admin/users/{id}/unban": {
      "post": {
        "description": "Remove ban from user account.",
        "operationId": "UserProfileController_unbanUser",
        "parameters": [
          {
            "name": "id",
            "required": true,
            "in": "path",
            "description": "User UUID",
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "User unbanned successfully"
          }
        },
        "security": [
          {
            "bearer": []
          }
        ],
        "summary": "Unban user (Admin)",
        "tags": [
          "User Management"
        ]
      }
    },
    "/api/user-management/admin/users/{id}/revoke-sessions": {
      "post": {
        "description": "Force logout user from all devices by revoking all sessions.",
        "operationId": "UserProfileController_revokeUserSessions",
        "parameters": [
          {
            "name": "id",
            "required": true,
            "in": "path",
            "description": "User UUID",
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Sessions revoked successfully"
          }
        },
        "security": [
          {
            "bearer": []
          }
        ],
        "summary": "Revoke user sessions (Admin)",
        "tags": [
          "User Management"
        ]
      }
    },
    "/api/user-management/admin/users/invite": {
      "post": {
        "description": "Send invitation email to new user with optional metadata and redirect URL. User will receive email with signup link.",
        "operationId": "UserProfileController_inviteUser",
        "parameters": [],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/InviteUserDto"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Invitation sent successfully",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/CreateUserResponseDto"
                }
              }
            }
          },
          "400": {
            "description": "Invalid email or invitation data"
          },
          "401": {
            "description": "Authentication required"
          },
          "403": {
            "description": "Admin access required"
          }
        },
        "security": [
          {
            "bearer": []
          }
        ],
        "summary": "Invite user (Admin)",
        "tags": [
          "User Management"
        ]
      }
    },
    "/api/roles": {
      "get": {
        "operationId": "RoleController_findAll",
        "parameters": [],
        "responses": {
          "200": {
            "description": "Roles retrieved successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "array",
                  "items": {
                    "$ref": "#/components/schemas/RoleDto"
                  }
                }
              }
            }
          }
        },
        "summary": "Get all roles",
        "tags": [
          "Roles"
        ]
      },
      "post": {
        "operationId": "RoleController_create",
        "parameters": [],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/CreateRoleDto"
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Role created successfully",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/RoleDto"
                }
              }
            }
          },
          "400": {
            "description": "Invalid role data"
          }
        },
        "summary": "Create role",
        "tags": [
          "Roles"
        ]
      }
    },
    "/api/roles/universal": {
      "get": {
        "operationId": "RoleController_findUniversal",
        "parameters": [],
        "responses": {
          "200": {
            "description": "Universal roles retrieved successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "array",
                  "items": {
                    "$ref": "#/components/schemas/RoleDto"
                  }
                }
              }
            }
          }
        },
        "summary": "Get universal roles",
        "tags": [
          "Roles"
        ]
      }
    },
    "/api/roles/{id}": {
      "get": {
        "operationId": "RoleController_findById",
        "parameters": [
          {
            "name": "id",
            "required": true,
            "in": "path",
            "description": "Role UUID",
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Role retrieved successfully",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/RoleDto"
                }
              }
            }
          },
          "404": {
            "description": "Role not found"
          }
        },
        "summary": "Get role by ID",
        "tags": [
          "Roles"
        ]
      },
      "put": {
        "operationId": "RoleController_update",
        "parameters": [
          {
            "name": "id",
            "required": true,
            "in": "path",
            "description": "Role UUID",
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/UpdateRoleDto"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Role updated successfully",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/RoleDto"
                }
              }
            }
          },
          "400": {
            "description": "Invalid role data"
          },
          "404": {
            "description": "Role not found"
          }
        },
        "summary": "Update role",
        "tags": [
          "Roles"
        ]
      },
      "delete": {
        "operationId": "RoleController_delete",
        "parameters": [
          {
            "name": "id",
            "required": true,
            "in": "path",
            "description": "Role UUID",
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Role deleted successfully"
          },
          "404": {
            "description": "Role not found"
          }
        },
        "summary": "Delete role",
        "tags": [
          "Roles"
        ]
      }
    },
    "/api/dev/test-token": {
      "get": {
        "description": "\n**Quick Swagger Authorization:**\n\n1. Call this endpoint\n2. Copy the 'supabaseToken' from response  \n3. Click 'Authorize' button in Swagger\n4. Enter: `Bearer <your_token>`\n5. Click 'Authorize' ‚úÖ\n\n‚ö†Ô∏è Development only - disabled in production.\n    ",
        "operationId": "DevController_getTestToken",
        "parameters": [],
        "responses": {
          "200": {
            "description": "Test token generated successfully for Swagger testing",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "message": {
                      "type": "string",
                      "example": "‚úÖ Test token generated for Swagger"
                    },
                    "testUser": {
                      "type": "object",
                      "properties": {
                        "email": {
                          "type": "string",
                          "example": "swagger-test-1234567890@example.com"
                        },
                        "id": {
                          "type": "string",
                          "example": "a1b2c3d4-e5f6-7890-abcd-ef1234567890"
                        }
                      }
                    },
                    "supabaseToken": {
                      "type": "string",
                      "example": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
                      "description": "Use this token in Swagger Authorization header"
                    }
                  }
                }
              }
            }
          },
          "403": {
            "description": "Test token endpoint not available in production"
          },
          "500": {
            "description": "Failed to create test token"
          }
        },
        "summary": "üîë Get Test Token for Swagger",
        "tags": [
          "Development"
        ]
      }
    }
  },
  "info": {
    "title": "Pravia Foundry API",
    "description": "Foundry Authorization API for Pravia ecosystem",
    "version": "1.0.585",
    "contact": {}
  },
  "tags": [
    {
      "name": "Application",
      "description": "Basic application information and metadata endpoints"
    },
    {
      "name": "Health",
      "description": "System health monitoring endpoints"
    }
  ],
  "servers": [],
  "components": {
    "securitySchemes": {
      "bearer": {
        "scheme": "bearer",
        "bearerFormat": "JWT",
        "type": "http",
        "name": "Authorization",
        "description": "Enter your JWT token",
        "in": "header"
      }
    },
    "schemas": {
      "ValidateTokenDto": {
        "type": "object",
        "properties": {
          "token": {
            "type": "string",
            "description": "Supabase access token to validate and convert to internal JWT",
            "example": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiaWF0IjoxNTE2MjM5MDIyfQ.SflKxwRJSMeKKF2QT4fwpMeJf36POk6yJV_adQssw5c",
            "minLength": 10
          }
        },
        "required": [
          "token"
        ]
      },
      "RefreshTokenDto": {
        "type": "object",
        "properties": {
          "refreshToken": {
            "type": "string",
            "description": "Supabase refresh token to generate new access token",
            "example": "refresh_token_eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiaWF0IjoxNTE2MjM5MDIyfQ",
            "minLength": 10
          }
        },
        "required": [
          "refreshToken"
        ]
      },
      "UserProfileDto": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string",
            "description": "Unique identifier for the user profile",
            "example": "123e4567-e89b-12d3-a456-426614174000"
          },
          "userId": {
            "type": "string",
            "description": "Reference to Supabase auth.users.id",
            "example": "123e4567-e89b-12d3-a456-426614174001"
          },
          "displayName": {
            "type": "string",
            "description": "User display name",
            "example": "John Doe"
          },
          "firstName": {
            "type": "string",
            "description": "User first name",
            "example": "John"
          },
          "lastName": {
            "type": "string",
            "description": "User last name",
            "example": "Doe"
          },
          "avatarUrl": {
            "type": "string",
            "description": "User avatar image URL",
            "example": "https://example.com/avatars/user123.jpg"
          },
          "timezone": {
            "type": "string",
            "description": "User timezone",
            "example": "America/New_York"
          },
          "locale": {
            "type": "string",
            "description": "User locale",
            "example": "en-US"
          },
          "preferences": {
            "type": "object",
            "description": "User preferences and settings",
            "example": {
              "theme": "dark",
              "notifications": {
                "email": true,
                "push": false
              }
            }
          },
          "organizationId": {
            "type": "string",
            "description": "Organization ID",
            "example": "123e4567-e89b-12d3-a456-426614174002"
          },
          "createdAt": {
            "format": "date-time",
            "type": "string",
            "description": "Profile creation timestamp",
            "example": "2024-01-01T00:00:00.000Z"
          },
          "updatedAt": {
            "format": "date-time",
            "type": "string",
            "description": "Profile last update timestamp",
            "example": "2024-01-01T00:00:00.000Z"
          }
        },
        "required": [
          "id",
          "userId",
          "createdAt",
          "updatedAt"
        ]
      },
      "CreateUserProfileDto": {
        "type": "object",
        "properties": {
          "displayName": {
            "type": "string",
            "description": "User display name shown in the application interface",
            "example": "John Doe",
            "maxLength": 100
          },
          "firstName": {
            "type": "string",
            "description": "User first name",
            "example": "John",
            "maxLength": 50
          },
          "lastName": {
            "type": "string",
            "description": "User last name",
            "example": "Doe",
            "maxLength": 50
          },
          "avatarUrl": {
            "type": "string",
            "description": "User avatar image URL",
            "example": "https://example.com/avatars/user123.jpg",
            "format": "uri"
          },
          "timezone": {
            "type": "string",
            "description": "User timezone for date/time display",
            "example": "America/New_York"
          },
          "locale": {
            "type": "string",
            "description": "User locale for internationalization",
            "example": "en-US"
          },
          "preferences": {
            "type": "object",
            "description": "User preferences and application settings",
            "example": {
              "theme": "dark",
              "notifications": {
                "email": true,
                "push": false
              },
              "dashboard": {
                "layout": "grid",
                "widgets": [
                  "weather",
                  "calendar"
                ]
              }
            }
          }
        }
      },
      "UpdateUserProfileDto": {
        "type": "object",
        "properties": {
          "displayName": {
            "type": "string",
            "description": "User display name shown in the application interface",
            "example": "John Doe",
            "maxLength": 100
          },
          "firstName": {
            "type": "string",
            "description": "User first name",
            "example": "John",
            "maxLength": 50
          },
          "lastName": {
            "type": "string",
            "description": "User last name",
            "example": "Doe",
            "maxLength": 50
          },
          "avatarUrl": {
            "type": "string",
            "description": "User avatar image URL",
            "example": "https://example.com/avatars/user123.jpg",
            "format": "uri"
          },
          "timezone": {
            "type": "string",
            "description": "User timezone for date/time display",
            "example": "America/New_York"
          },
          "locale": {
            "type": "string",
            "description": "User locale for internationalization",
            "example": "en-US"
          },
          "preferences": {
            "type": "object",
            "description": "User preferences and application settings",
            "example": {
              "theme": "dark",
              "notifications": {
                "email": true,
                "push": false
              },
              "dashboard": {
                "layout": "grid",
                "widgets": [
                  "weather",
                  "calendar"
                ]
              }
            }
          }
        }
      },
      "UpdateOrganizationDto": {
        "type": "object",
        "properties": {
          "organizationId": {
            "type": "string",
            "description": "Organization UUID to assign to the user",
            "example": "b2c3d4e5-f6a7-8901-bcde-f12345678901",
            "format": "uuid"
          }
        },
        "required": [
          "organizationId"
        ]
      },
      "RefreshViewResponseDto": {
        "type": "object",
        "properties": {
          "success": {
            "type": "boolean",
            "description": "Operation success status",
            "example": true
          },
          "message": {
            "type": "string",
            "description": "Response message",
            "example": "Materialized view refreshed successfully"
          }
        },
        "required": [
          "success",
          "message"
        ]
      },
      "CreateUserDto": {
        "type": "object",
        "properties": {
          "email": {
            "type": "string",
            "description": "User email address",
            "example": "john.doe@example.com",
            "format": "email"
          },
          "password": {
            "type": "string",
            "description": "User password (optional - if not provided, user will need to set via magic link)",
            "example": "SecurePassword123!",
            "minLength": 8
          },
          "user_metadata": {
            "type": "object",
            "description": "User metadata for profile creation",
            "example": {
              "first_name": "John",
              "last_name": "Doe",
              "role": "user"
            }
          },
          "email_confirm": {
            "type": "boolean",
            "description": "Whether to automatically confirm email (true) or require email verification (false)",
            "example": true,
            "default": true
          }
        },
        "required": [
          "email"
        ]
      },
      "SupabaseUserDto": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string",
            "description": "User ID",
            "example": "a1b2c3d4-e5f6-7890-abcd-ef1234567890"
          },
          "email": {
            "type": "string",
            "description": "User email",
            "example": "john.doe@example.com"
          },
          "created_at": {
            "type": "string",
            "description": "User creation timestamp",
            "example": "2024-01-15T10:30:00Z"
          },
          "email_confirmed_at": {
            "type": "string",
            "description": "Email confirmation timestamp"
          },
          "last_sign_in_at": {
            "type": "string",
            "description": "Last sign in timestamp"
          }
        },
        "required": [
          "id",
          "created_at"
        ]
      },
      "CreateUserResponseDto": {
        "type": "object",
        "properties": {
          "user": {
            "description": "Supabase user object",
            "allOf": [
              {
                "$ref": "#/components/schemas/SupabaseUserDto"
              }
            ]
          },
          "profile": {
            "description": "User profile (if metadata was provided)",
            "allOf": [
              {
                "$ref": "#/components/schemas/UserProfileDto"
              }
            ]
          }
        },
        "required": [
          "user"
        ]
      },
      "UpdateUserDto": {
        "type": "object",
        "properties": {
          "email": {
            "type": "string",
            "description": "Updated email address",
            "example": "newemail@example.com",
            "format": "email"
          },
          "user_metadata": {
            "type": "object",
            "description": "Updated user metadata",
            "example": {
              "first_name": "Jane",
              "last_name": "Smith",
              "role": "admin"
            }
          }
        }
      },
      "BanUserDto": {
        "type": "object",
        "properties": {
          "duration": {
            "type": "string",
            "description": "Ban duration (e.g., \"24h\", \"7d\", \"permanent\")",
            "example": "24h",
            "default": "24h"
          }
        }
      },
      "InviteUserDto": {
        "type": "object",
        "properties": {
          "email": {
            "type": "string",
            "description": "Email address to send invitation to",
            "example": "newuser@example.com",
            "format": "email"
          },
          "data": {
            "type": "object",
            "description": "Additional data to include in invitation",
            "example": {
              "role": "user",
              "department": "Engineering"
            }
          },
          "redirectTo": {
            "type": "string",
            "description": "URL to redirect user after accepting invitation",
            "example": "https://app.example.com/welcome"
          }
        },
        "required": [
          "email"
        ]
      },
      "RoleDto": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string",
            "description": "Unique identifier for the role",
            "example": "123e4567-e89b-12d3-a456-426614174000"
          },
          "name": {
            "type": "string",
            "description": "Role name",
            "example": "Admin"
          },
          "description": {
            "type": "string",
            "description": "Role description",
            "example": "Administrator with full access"
          },
          "parentRoleId": {
            "type": "string",
            "description": "Parent role ID for hierarchical roles",
            "example": "123e4567-e89b-12d3-a456-426614174001"
          },
          "level": {
            "type": "number",
            "description": "Role hierarchy level",
            "example": 0
          },
          "isSystem": {
            "type": "boolean",
            "description": "Whether this is a system-defined role",
            "example": false
          },
          "isUniversal": {
            "type": "boolean",
            "description": "Whether this role is available across all organizations",
            "example": false
          },
          "organizationId": {
            "type": "string",
            "description": "Organization ID this role belongs to",
            "example": "123e4567-e89b-12d3-a456-426614174002"
          },
          "metadata": {
            "type": "object",
            "description": "Additional role metadata",
            "example": {
              "permissions": [
                "read",
                "write"
              ]
            }
          },
          "createdAt": {
            "format": "date-time",
            "type": "string",
            "description": "Role creation timestamp",
            "example": "2024-01-01T00:00:00.000Z"
          },
          "updatedAt": {
            "format": "date-time",
            "type": "string",
            "description": "Role last update timestamp",
            "example": "2024-01-01T00:00:00.000Z"
          }
        },
        "required": [
          "id",
          "name",
          "level",
          "isSystem",
          "isUniversal",
          "createdAt",
          "updatedAt"
        ]
      },
      "CreateRoleDto": {
        "type": "object",
        "properties": {
          "name": {
            "type": "string",
            "description": "Role name",
            "example": "Admin"
          },
          "description": {
            "type": "string",
            "description": "Role description",
            "example": "Administrator with full access"
          },
          "parentRoleId": {
            "type": "string",
            "description": "Parent role ID for hierarchical roles",
            "example": "123e4567-e89b-12d3-a456-426614174001"
          },
          "level": {
            "type": "number",
            "description": "Role hierarchy level",
            "example": 0,
            "default": 0
          },
          "isSystem": {
            "type": "boolean",
            "description": "Whether this is a system-defined role",
            "example": false,
            "default": false
          },
          "isUniversal": {
            "type": "boolean",
            "description": "Whether this role is available across all organizations",
            "example": false,
            "default": false
          },
          "organizationId": {
            "type": "string",
            "description": "Organization ID this role belongs to",
            "example": "123e4567-e89b-12d3-a456-426614174002"
          },
          "metadata": {
            "type": "object",
            "description": "Additional role metadata",
            "example": {
              "permissions": [
                "read",
                "write"
              ]
            }
          }
        },
        "required": [
          "name"
        ]
      },
      "UpdateRoleDto": {
        "type": "object",
        "properties": {
          "name": {
            "type": "string",
            "description": "Role name",
            "example": "Admin"
          },
          "description": {
            "type": "string",
            "description": "Role description",
            "example": "Administrator with full access"
          },
          "parentRoleId": {
            "type": "string",
            "description": "Parent role ID for hierarchical roles",
            "example": "123e4567-e89b-12d3-a456-426614174001"
          },
          "level": {
            "type": "number",
            "description": "Role hierarchy level",
            "example": 0,
            "default": 0
          },
          "isSystem": {
            "type": "boolean",
            "description": "Whether this is a system-defined role",
            "example": false,
            "default": false
          },
          "isUniversal": {
            "type": "boolean",
            "description": "Whether this role is available across all organizations",
            "example": false,
            "default": false
          },
          "organizationId": {
            "type": "string",
            "description": "Organization ID this role belongs to",
            "example": "123e4567-e89b-12d3-a456-426614174002"
          },
          "metadata": {
            "type": "object",
            "description": "Additional role metadata",
            "example": {
              "permissions": [
                "read",
                "write"
              ]
            }
          }
        }
      }
    }
  }
}